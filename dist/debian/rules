#!/usr/bin/make -f
# Sample debian/rules that uses debhelper.
# GNU copyright 1997 to 1999 by Joey Hess.

BUNDLE = /opt/vexor/bin/bundle
DIST = $(shell pwd)/debian/vx-worker/opt/vexor/worker

%:
	dh $@

override_dh_auto_install:
	$(BUNDLE) install --without development --local --standalone
	mkdir -p $(DIST)
	cp -r bin $(DIST)
	cp -r docker $(DIST)
	cp -r lib $(DIST)
	cp -r bundle $(DIST)
	rm -rf $(DIST)/debian
	mkdir -p debian/vx-worker/etc/vexor
	install -m 0644 debian/ci_env debian/vx-worker/etc/vexor/ci
	mkdir -p debian/vx-worker/opt/vexor/bin
	install -m 0755 debian/script debian/vx-worker/opt/vexor/bin/worker
